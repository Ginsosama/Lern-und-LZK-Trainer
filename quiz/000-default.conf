<VirtualHost *:8080>
    ServerName localhost
    DocumentRoot /var/www/quiz
    DirectoryIndex index.html

    <Directory /var/www/quiz>
        Options +Indexes +FollowSymLinks +MultiViews
        AllowOverride None
        Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>

<VirtualHost *:8099>
    ServerName localhost
    DocumentRoot /var/www/quiz
    DirectoryIndex index.html index.php

    # CORS-Header für Cross-Origin-Anfragen
    <Directory /var/www/quiz>
        Options +Indexes +FollowSymLinks +MultiViews
        AllowOverride None
        Require all granted
        RewriteEngine On
        RewriteCond %{REQUEST_METHOD} =OPTIONS
        RewriteRule ^(.*)$ $1 [R=200,L]
    </Directory>
    
    <Directory /var/www/quiz/php>
        Options +FollowSymLinks
        AllowOverride None
        Require all granted
        RewriteEngine On
        RewriteCond %{REQUEST_METHOD} =OPTIONS
        RewriteRule ^(.*)$ $1 [R=200,L]
        Header set Access-Control-Allow-Origin "*"
        Header set Access-Control-Allow-Methods "GET, POST, OPTIONS"
        Header set Access-Control-Allow-Headers "Content-Type"
    </Directory>

    <IfModule mod_headers.c>
        # Erlaubt Anfragen von Ihrem playit.gg‑Hostname, ersetzen Sie die URL durch Ihren eigenen Tunnel‑Host
        Header set Access-Control-Allow-Origin "https://xy123.playit.gg"
        Header set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Header set Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept"
    </IfModule>

    # Weiterleitung von API-Aufrufen an den Node-Server …
    ProxyPreserveHost On
    # Login und Benutzerverwaltung
    ProxyPass /login http://192.168.0.3:8081/login
    ProxyPassReverse /login http://192.168.0.3:8081/login
    ProxyPass /users http://192.168.0.3:8081/users
    ProxyPassReverse /users http://192.168.0.3:8081/users
    # Dateioperationen
    ProxyPass /upload http://192.168.0.3:8081/upload
    ProxyPassReverse /upload http://192.168.0.3:8081/upload
    ProxyPass /save http://192.168.0.3:8081/save
    ProxyPassReverse /save http://192.168.0.3:8081/save
    # /files bleibt ein Alias auf /var/www/quiz/files

    ErrorLog /var/log/apache2/8099_error.log
    CustomLog /var/log/apache2/8099_access.log combined
</VirtualHost>
